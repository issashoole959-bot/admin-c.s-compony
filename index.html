<!doctype html>
<html lang="so">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <title>C.S Company Admin - Orders</title>
  <style>
    :root{
      --blue:#0b4f8b;
      --accent:#0b6fb5;
      --light:#f6f9fc;
      --muted:#6b7280;
      --danger:#ff6b6b;
      --radius:10px;
    }
    body{
      background:var(--light);
      margin:0;
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .box{max-width:1100px;width:100%;background:#fff;border-radius:var(--radius);box-shadow:0 10px 30px rgba(11,79,139,0.08);overflow:hidden}
    header{background:linear-gradient(90deg,var(--blue),var(--accent));color:#fff;padding:16px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    header h1{margin:0;font-size:18px}
    .header-actions{display:flex;gap:8px;align-items:center}
    .content{padding:18px}
    #loginBox{padding:12px 0;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    input[type="password"], input[type="text"], input[type="tel"], textarea{padding:10px;border-radius:8px;border:1px solid #e6eef8;flex:1 1 260px;min-width:0}
    textarea{min-height:100px;resize:vertical}
    .btn{padding:10px 14px;border-radius:8px;border:none;background:var(--blue);color:#fff;cursor:pointer;font-weight:600}
    .btn[disabled]{opacity:0.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--blue);border:1px solid rgba(11,79,139,0.08)}
    .btn.danger{background:var(--danger)}
    .btn:hover{opacity:0.95;transition:0.15s}
    .muted{color:var(--muted);font-size:13px}
    .table-wrap{width:100%;overflow-x:auto;margin-top:12px;border-radius:8px;max-height:70vh;overflow-y:auto;}
    table{width:100%;border-collapse:collapse;min-width:900px}
    th,td{padding:10px 12px;border-bottom:1px solid #eef6fb;text-align:left;font-size:14px;vertical-align:middle}
    th{background:#f4fbff;color:var(--blue);font-weight:600;position:sticky;top:0;z-index:2}
    .actions button{margin-right:8px}
    .small{font-size:13px;color:var(--muted)}
    @media (max-width:900px){
      header{padding:12px}
      .content{padding:12px}
      th,td{padding:10px 8px;font-size:13px}
      table{min-width:700px}
    }
    @media (max-width:600px){
      body{padding:12px}
      header h1{font-size:16px}
      .box{border-radius:12px}
      #loginBox{flex-direction:column;align-items:stretch}
      input[type="password"]{width:100%}
      .btn{width:100%}
      .controls-row{display:flex;flex-direction:column;gap:8px}
      table{min-width:600px}
    }
    @media (max-width:420px){
      .table-wrap{margin-top:8px}
      table, thead, tbody, th, td, tr { display:block; }
      thead { display:none; }
      tr{margin-bottom:12px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(11,79,139,0.03);padding:10px}
      td{border:none;display:flex;justify-content:space-between;padding:6px 0}
      td::before{content:attr(data-label);font-weight:600;color:var(--muted);margin-right:8px;flex:0 0 40%}
      td span{flex:1;text-align:right}
    }
    .row{display:flex;gap:8px;align-items:center}
    .right{margin-left:auto}
    .btn:focus, input:focus, textarea:focus { outline:3px solid rgba(11,111,181,0.18); outline-offset:2px; }
    td span, .muted, input, textarea { word-break:break-word; }
    .contact-wrap{margin-top:18px;padding:14px;border-radius:8px;background:#fbfeff;border:1px solid #eef9ff}
  </style>
</head>
<body>
  <div class="box">
    <header>
      <h1>C.S Company - Admin Orders</h1>
      <div class="header-actions">
        <div style="font-size:13px">Ciise Shoole ðŸ”±</div>
        <a href="mailto:cscompany.tech@gmail.com" class="btn ghost" style="text-decoration:none;color:white;background:transparent;border:1px solid rgba(255,255,255,0.15);">Contact</a>
      </div>
    </header>

    <div class="content">
      <!-- LOGIN -->
      <div id="loginBox">
        <div style="flex:1 1 320px">
          <div class="muted">Fadlan geli password si aad u aragto orders (admin only)</div>
          <div style="height:8px"></div>
          <div style="display:flex;gap:8px">
            <input id="password" type="password" placeholder="Password">
            <button class="btn" id="togglePass" type="button">Show</button>
          </div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" id="loginBtn" type="button">Login</button>
          <button class="btn ghost" id="demoBtn" type="button">Add Demo</button>
        </div>
      </div>

      <!-- ADMIN AREA -->
      <div id="adminArea" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div>
            <h3 style="margin:0 0 6px 0">Orders (Local Storage)</h3>
            <div class="muted">Kaliya adiga ayaa arki kara boggan haddii aad haysato password-ka.</div>
          </div>
          <div class="row controls-row">
            <button class="btn" id="exportBtn" type="button">Export CSV</button>
            <button class="btn danger" id="clearBtn" type="button">Clear All</button>
            <button class="btn ghost" id="viewMsgsBtn" type="button">View Messages</button>
          </div>
        </div>

        <div class="table-wrap">
          <table id="ordersTable">
            <thead><tr><th>ID</th><th>Magac</th><th>Phone</th><th>Region</th><th>Product</th><th>Payment</th><th>Price</th><th>Time</th><th>Action</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- CONTACT FORM -->
      <div class="contact-wrap">
        <h3 style="margin:0 0 8px 0">Xiriir / Message</h3>
        <div class="muted" style="margin-bottom:8px">Buuxi foomka hoos, fariinta waxaa arkaya admin marka uu galo.</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <input id="c_name" type="text" placeholder="Magac">
          <input id="c_phone" type="tel" placeholder="Phone">
        </div>
        <div style="height:8px"></div>
        <textarea id="c_message" placeholder="Fariintaada..."></textarea>
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="sendMsgBtn" type="button">Send Message</button>
          <button class="btn ghost" id="clearFormBtn" type="button">Clear</button>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const ADMIN_PASS = 'Ciise000@';
  const loginBtn = document.getElementById('loginBtn');
  const passwordInput = document.getElementById('password');
  const adminArea = document.getElementById('adminArea');
  const loginBox = document.getElementById('loginBox');
  const ordersTableBody = document.querySelector('#ordersTable tbody');
  const exportBtn = document.getElementById('exportBtn');
  const clearBtn = document.getElementById('clearBtn');
  const togglePass = document.getElementById('togglePass');
  const demoBtn = document.getElementById('demoBtn');
  const viewMsgsBtn = document.getElementById('viewMsgsBtn');
  const c_name = document.getElementById('c_name');
  const c_phone = document.getElementById('c_phone');
  const c_message = document.getElementById('c_message');
  const sendMsgBtn = document.getElementById('sendMsgBtn');
  const clearFormBtn = document.getElementById('clearFormBtn');

  function safeParse(json, fallback){ try { return JSON.parse(json)||fallback; } catch(e){ return fallback; } }
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function makeRowHTML(o){
    return `<tr>
      <td data-label="ID"><span>${escapeHtml(o.id)}</span></td>
      <td data-label="Magac"><span>${escapeHtml(o.name)}</span></td>
      <td data-label="Phone"><span>${escapeHtml(o.phone)}</span></td>
      <td data-label="Region"><span>${escapeHtml(o.region)}</span></td>
      <td data-label="Product"><span>${escapeHtml(o.product)}</span></td>
      <td data-label="Payment"><span>${escapeHtml(o.payment)}</span></td>
      <td data-label="Price"><span>$${escapeHtml(o.price)}</span></td>
      <td data-label="Time"><span>${new Date(o.time).toLocaleString()}</span></td>
      <td data-label="Action" class="actions">
        <button data-id="${o.id}" class="btn viewBtn" type="button">View</button>
        <button data-id="${o.id}" class="btn delBtn" style="background:#ff6b6b" type="button">Delete</button>
      </td></tr>`;
  }

  function loadOrders(){
    const orders = safeParse(localStorage.getItem('cs_orders'), []);
    ordersTableBody.innerHTML = '';
    if(!orders.length){ ordersTableBody.innerHTML = '<tr><td colspan="9" class="small">Ma jiraan orders.</td></tr>'; return; }
    orders.slice().reverse().forEach(o=>ordersTableBody.insertAdjacentHTML('beforeend', makeRowHTML(o)));
    attachRowEvents();
  }
  function attachRowEvents(){
    document.querySelectorAll('.delBtn').forEach(b=>b.onclick=e=>{
      const id=e.target.dataset.id; if(!confirm('Delete '+id+'?'))return;
      let orders=safeParse(localStorage.getItem('cs_orders'),[]).filter(x=>x.id!==id);
      localStorage.setItem('cs_orders',JSON.stringify(orders)); loadOrders();
    });
    document.querySelectorAll('.viewBtn').forEach(b=>b.onclick=e=>{
      const id=e.target.dataset.id; const o=safeParse(localStorage.getItem('cs_orders'),[]).find(x=>x.id===id);
      if(!o)return alert('Order lama helin');
      alert(`ID: ${o.id}\nMagac: ${o.name}\nPhone: ${o.phone}\nRegion: ${o.region}\nProduct: ${o.product}\nPayment: ${o.payment}\nPrice: $${o.price}\nTime: ${new Date(o.time).toLocaleString()}`);
    });
  }

  /* FIX: Update message count + auto load */
  function loadMessages(){ return safeParse(localStorage.getItem('cs_messages'), []); }
  function updateMsgCount(){
    const msgs = loadMessages(); const unread = msgs.length;
    viewMsgsBtn.textContent = unread>0?`View Messages (${unread})`:"View Messages";
  }

  loginBtn.onclick=()=>{
    if(passwordInput.value===ADMIN_PASS){
      loginBox.style.display='none'; adminArea.style.display='block';
      sessionStorage.setItem('cs_admin_logged','1');
      loadOrders(); updateMsgCount();
    } else alert('Password khaldan');
  };
  passwordInput.addEventListener('keyup',e=>{if(e.key==='Enter')loginBtn.click();});
  togglePass.onclick=()=>{ if(passwordInput.type==='password'){passwordInput.type='text';togglePass.textContent='Hide';}else{passwordInput.type='password';togglePass.textContent='Show';}};
  demoBtn.onclick=()=>{const o={id:'ORD'+Math.floor(Math.random()*90000+10000),name:'Ahmed',phone:'0612345678',region:'Mogadishu',product:'Gari',payment:'Cash',price:49.99,time:Date.now()};const arr=safeParse(localStorage.getItem('cs_orders'),[]);arr.push(o);localStorage.setItem('cs_orders',JSON.stringify(arr));alert('Demo order la dhajiyey');};
  exportBtn.onclick=()=>{const arr=safeParse(localStorage.getItem('cs_orders'),[]);if(!arr.length)return alert('Ma jiraan orders');const csv=['id,name,phone,region,product,payment,price,time'];arr.forEach(o=>csv.push([o.id,o.name,o.phone,o.region,o.product,o.payment,o.price,o.time].map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')));const blob=new Blob([csv.join('\n')],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='cs_orders_'+Date.now()+'.csv';a.click();};
  clearBtn.onclick=()=>{if(confirm('Clear all?')){localStorage.removeItem('cs_orders');loadOrders();}};
  if(sessionStorage.getItem('cs_admin_logged')==='1'){loginBox.style.display='none';adminArea.style.display='block';loadOrders();updateMsgCount();}

  sendMsgBtn.onclick=()=>{
    const name=c_name.value.trim(),phone=c_phone.value.trim(),msg=c_message.value.trim();
    if(!name||!msg)return alert('Fadlan buuxi Magac iyo Fariin');
    const arr=loadMessages();arr.push({id:'MSG'+Math.floor(Math.random()*900000+100000),name,phone,message:msg,time:Date.now()});
    localStorage.setItem('cs_messages',JSON.stringify(arr));
    alert('Fariinta waa la diray. Mahadsanid!');
    c_name.value=c_phone.value=c_message.value='';
    updateMsgCount(); // update admin count live
  };
  clearFormBtn.onclick=()=>{c_name.value=c_phone.value=c_message.value='';};
  viewMsgsBtn.onclick=()=>{
    const msgs=loadMessages(); if(!msgs.length)return alert('Ma jiraan fariimo.');
    const lines=msgs.slice().reverse().map(m=>`ID: ${m.id}\nMagac: ${m.name}\nPhone: ${m.phone||'-'}\nTime: ${new Date(m.time).toLocaleString()}\nFariin: ${m.message}\n----`).join('\n\n');
    if(lines.length>1500){const w=window.open('','_blank');w.document.write('<pre>'+escapeHtml(lines)+'</pre>');}else alert(lines);
  };
})();
</script>
</body>
</html>
